# kimi-cli å¯åŠ¨è°ƒç”¨æ ˆå®Œæ•´åˆ†æ

> åˆ†æå‘½ä»¤ï¼š`uv run kimi`ï¼ˆShell äº¤äº’æ¨¡å¼ï¼‰
> ç”Ÿæˆæ—¶é—´ï¼š2026-01-22

## ğŸ¯ å¯åŠ¨å…¥å£ç‚¹

### 1. å‘½ä»¤è¡Œå…¥å£ï¼ˆpyproject.tomlï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`pyproject.toml` ç¬¬ 66-68 è¡Œ

```toml
[project.scripts]
kimi = "kimi_cli.cli:cli"        # â† uv run kimi æ‰§è¡Œè¿™ä¸ª
kimi-cli = "kimi_cli.cli:cli"    # åˆ«å
```

**è§£é‡Š**ï¼š
- `uv run kimi` æ‰§è¡Œ `kimi_cli.cli` æ¨¡å—çš„ `cli` å¯¹è±¡
- `cli` æ˜¯ä¸€ä¸ª `typer.Typer()` åº”ç”¨å®ä¾‹

---

## ğŸ“Š å®Œæ•´è°ƒç”¨æ ˆ

```
uv run kimiï¼ˆç”¨æˆ·å‘½ä»¤ï¼‰
  â”‚
  â”œâ”€ Python è§£é‡Šå™¨å¯åŠ¨
  â”‚
  â””â”€ å¯¼å…¥ kimi_cli.cli æ¨¡å—
       â”‚
       â””â”€ src/kimi_cli/cli/__init__.py
            â”‚
            â”œâ”€ ç¬¬ 24 è¡Œï¼šåˆ›å»º Typer åº”ç”¨
            â”‚   cli = typer.Typer(...)
            â”‚
            â”œâ”€ ç¬¬ 44 è¡Œï¼šä¸»å›è°ƒå‡½æ•°
            â”‚   @cli.callback(invoke_without_command=True)
            â”‚   def kimi(ctx, ...å„ç§å‚æ•°...)
            â”‚
            â”œâ”€ Typer æ¡†æ¶è°ƒç”¨ kimi() å‡½æ•°
            â”‚   â”‚
            â”‚   â”œâ”€ ç¬¬ 380-386 è¡Œï¼šç¡®å®š UI æ¨¡å¼
            â”‚   â”‚   ui: UIMode = "shell"  # â† é»˜è®¤å€¼
            â”‚   â”‚   if print_mode: ui = "print"
            â”‚   â”‚   elif acp_mode: ui = "acp"
            â”‚   â”‚   elif wire_mode: ui = "wire"
            â”‚   â”‚
            â”‚   â”œâ”€ ç¬¬ 476-497 è¡Œï¼šåˆ›å»ºæˆ–æ¢å¤ Session
            â”‚   â”‚   async def _run(session_id):
            â”‚   â”‚       session = await Session.create(work_dir)
            â”‚   â”‚
            â”‚   â”œâ”€ ç¬¬ 499-512 è¡Œï¼šåˆ›å»º KimiCLI å®ä¾‹
            â”‚   â”‚   instance = await KimiCLI.create(
            â”‚   â”‚       session, config, model_name, ...
            â”‚   â”‚   )
            â”‚   â”‚
            â”‚   â””â”€ ç¬¬ 513-532 è¡Œï¼šæ ¹æ® UI æ¨¡å¼è¿è¡Œ
            â”‚       match ui:
            â”‚           case "shell":
            â”‚               succeeded = await instance.run_shell(prompt)  # â† Shell æ¨¡å¼ï¼
            â”‚
            â””â”€ src/kimi_cli/app.py
                 â”‚
                 â””â”€ KimiCLI.run_shell() æ–¹æ³•ï¼ˆç¬¬ 235-287 è¡Œï¼‰
                      â”‚
                      â”œâ”€ ç¬¬ 237-284 è¡Œï¼šå‡†å¤‡æ¬¢è¿ä¿¡æ¯
                      â”‚   welcome_info = [
                      â”‚       WelcomeInfoItem("Directory", work_dir),
                      â”‚       WelcomeInfoItem("Session", session.id),
                      â”‚       WelcomeInfoItem("Model", model_name),
                      â”‚   ]
                      â”‚
                      â”œâ”€ ç¬¬ 285-287 è¡Œï¼šå¯åŠ¨ Shell UI
                      â”‚   async with self._env():
                      â”‚       shell = Shell(self._soul, welcome_info=welcome_info)
                      â”‚       return await shell.run(command)
                      â”‚
                      â””â”€ src/kimi_cli/ui/shell/__init__.py
                           â”‚
                           â””â”€ Shell.run() æ–¹æ³•
                                â”‚
                                â”œâ”€ æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
                                â”œâ”€ è¿›å…¥ä¸»å¾ªç¯
                                â””â”€ ç­‰å¾…ç”¨æˆ·è¾“å…¥
```

---

## ğŸ” å…³é”®æ–‡ä»¶è¯¦è§£

### æ–‡ä»¶ 1ï¼špyproject.tomlï¼ˆå…¥å£å®šä¹‰ï¼‰

**ä½ç½®**ï¼šé¡¹ç›®æ ¹ç›®å½• `pyproject.toml`

**å…³é”®å†…å®¹**ï¼š
```toml
[project.scripts]
kimi = "kimi_cli.cli:cli"
```

**ä½œç”¨**ï¼š
- å®šä¹‰å‘½ä»¤è¡Œå·¥å…·çš„å…¥å£ç‚¹
- `uv run kimi` â†’ å¯¼å…¥ `kimi_cli.cli` â†’ è°ƒç”¨ `cli` å¯¹è±¡

---

### æ–‡ä»¶ 2ï¼šsrc/kimi_cli/cli/__init__.pyï¼ˆCLI ä¸»é€»è¾‘ï¼‰

**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š

```python
# ç¬¬ 24 è¡Œï¼šåˆ›å»º Typer åº”ç”¨
cli = typer.Typer(
    help="Kimi, your next CLI agent.",
)

# ç¬¬ 44 è¡Œï¼šä¸»å›è°ƒå‡½æ•°ï¼ˆæ— å‚æ•°æ—¶è°ƒç”¨ï¼‰
@cli.callback(invoke_without_command=True)
def kimi(
    ctx: typer.Context,
    # å„ç§å‚æ•°...
    print_mode: bool = False,
    acp_mode: bool = False,
    wire_mode: bool = False,
    ...
):
    # ç¬¬ 380-386 è¡Œï¼šç¡®å®š UI æ¨¡å¼
    ui: UIMode = "shell"  # â† é»˜è®¤ Shell æ¨¡å¼
    if print_mode:
        ui = "print"
    elif acp_mode:
        ui = "acp"
    elif wire_mode:
        ui = "wire"

    # ç¬¬ 478-497 è¡Œï¼šåˆ›å»º Session
    async def _run(session_id):
        session = await Session.create(work_dir)

        # ç¬¬ 499-512 è¡Œï¼šåˆ›å»º KimiCLI å®ä¾‹
        instance = await KimiCLI.create(
            session,
            config=config,
            model_name=model_name,
            ...
        )

        # ç¬¬ 513-532 è¡Œï¼šè¿è¡Œå¯¹åº”çš„ UI æ¨¡å¼
        match ui:
            case "shell":
                succeeded = await instance.run_shell(prompt)  # â† è¿™é‡Œï¼
            case "print":
                succeeded = await instance.run_print(...)
            case "acp":
                await instance.run_acp()
            case "wire":
                await instance.run_wire_stdio()

        return succeeded

    # ç¬¬ 562-571 è¡Œï¼šæ‰§è¡Œå¼‚æ­¥å‡½æ•°
    while True:
        try:
            succeeded = asyncio.run(_run(session_id))
            break
        except Reload as e:
            session_id = e.session_id
            continue
```

---

### æ–‡ä»¶ 3ï¼šsrc/kimi_cli/app.pyï¼ˆKimiCLI ä¸»ç±»ï¼‰

**KimiCLI.run_shell() æ–¹æ³•**ï¼ˆç¬¬ 235-287 è¡Œï¼‰ï¼š

```python
async def run_shell(self, command: str | None = None) -> bool:
    """Run the Kimi CLI instance with shell UI."""
    from kimi_cli.ui.shell import Shell, WelcomeInfoItem

    # å‡†å¤‡æ¬¢è¿ä¿¡æ¯
    welcome_info = [
        WelcomeInfoItem(name="Directory", value=str(self._runtime.session.work_dir)),
        WelcomeInfoItem(name="Session", value=self._runtime.session.id),
    ]

    # æ˜¾ç¤ºæ¨¡å‹ä¿¡æ¯
    if not self._runtime.llm:
        welcome_info.append(
            WelcomeInfoItem(
                name="Model",
                value="not set, send /setup to configure",
                level=WelcomeInfoItem.Level.WARN,
            )
        )
    else:
        welcome_info.append(
            WelcomeInfoItem(
                name="Model",
                value=self._soul.model_name,
            )
        )

    # å¯åŠ¨ Shell UI
    async with self._env():
        shell = Shell(self._soul, welcome_info=welcome_info)
        return await shell.run(command)
```

---

### æ–‡ä»¶ 4ï¼šsrc/kimi_cli/ui/shell/__init__.pyï¼ˆShell UIï¼‰

**Shell.run() æ–¹æ³•**ï¼š

```python
async def run(self, command: str | None = None) -> bool:
    """è¿è¡Œ Shell äº¤äº’å¾ªç¯"""

    # æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
    self._print_welcome()

    # å¦‚æœæœ‰åˆå§‹å‘½ä»¤ï¼Œå…ˆæ‰§è¡Œ
    if command:
        await self._handle_user_input(command)

    # ä¸»å¾ªç¯ï¼šç­‰å¾…ç”¨æˆ·è¾“å…¥
    while True:
        try:
            user_input = await self._prompt_session.prompt_async()
            if not user_input.strip():
                continue

            # å¤„ç†ç”¨æˆ·è¾“å…¥
            await self._handle_user_input(user_input)

        except KeyboardInterrupt:
            continue
        except EOFError:  # Ctrl-D
            break

    return True
```

---

## ğŸ¨ å¯åŠ¨æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·æ‰§è¡Œå‘½ä»¤                                                   â”‚
â”‚    $ uv run kimi                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. uv æŸ¥æ‰¾ pyproject.toml                                        â”‚
â”‚    [project.scripts]                                            â”‚
â”‚    kimi = "kimi_cli.cli:cli"                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Python å¯¼å…¥æ¨¡å—                                                â”‚
â”‚    import kimi_cli.cli                                          â”‚
â”‚    æ‰§è¡Œ src/kimi_cli/cli/__init__.py                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. åˆ›å»º Typer åº”ç”¨                                                â”‚
â”‚    cli = typer.Typer(...)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Typer è°ƒç”¨ä¸»å›è°ƒå‡½æ•°                                           â”‚
â”‚    @cli.callback(invoke_without_command=True)                   â”‚
â”‚    def kimi(...)                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ç¡®å®š UI æ¨¡å¼                                                   â”‚
â”‚    ui = "shell"  # é»˜è®¤å€¼ï¼ˆæ— å‚æ•°ï¼‰                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. åˆ›å»º/æ¢å¤ Session                                              â”‚
â”‚    session = await Session.create(work_dir)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. åˆ›å»º KimiCLI å®ä¾‹                                              â”‚
â”‚    instance = await KimiCLI.create(...)                         â”‚
â”‚    - åŠ è½½é…ç½®                                                     â”‚
â”‚    - åˆ›å»º LLM                                                    â”‚
â”‚    - åˆ›å»º Runtime                                                â”‚
â”‚    - åŠ è½½ Agent                                                  â”‚
â”‚    - æ¢å¤ Context                                                â”‚
â”‚    - åˆ›å»º KimiSoul                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. è¿è¡Œ Shell UI                                                 â”‚
â”‚    await instance.run_shell(prompt)                             â”‚
â”‚    â†’ Shell(soul, welcome_info).run()                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. æ˜¾ç¤ºæ¬¢è¿ç•Œé¢                                                  â”‚
â”‚     â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                        â”‚
â”‚     â”‚ â–â–ˆâ–›â–ˆâ–›â–ˆâ–Œ Welcome to Kimi CLI!     â”‚                        â”‚
â”‚     â”‚ Directory: /opt/script/kimi-cli   â”‚                        â”‚
â”‚     â”‚ Session: xxx-xxx-xxx              â”‚                        â”‚
â”‚     â”‚ Model: claude-3-7-sonnet...       â”‚                        â”‚
â”‚     â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. è¿›å…¥ä¸»å¾ªç¯                                                    â”‚
â”‚     while True:                                                 â”‚
â”‚         user_input = await prompt()    # ç­‰å¾…ç”¨æˆ·è¾“å…¥            â”‚
â”‚         await handle_input(user_input) # å¤„ç†è¾“å…¥               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ å…³é”®ç‚¹æ€»ç»“

### 1. å…¥å£æ–‡ä»¶é“¾

```
pyproject.toml
  â†’ src/kimi_cli/cli/__init__.py
    â†’ src/kimi_cli/app.py
      â†’ src/kimi_cli/ui/shell/__init__.py
```

### 2. ä¸ºä»€ä¹ˆé»˜è®¤æ˜¯ Shell æ¨¡å¼ï¼Ÿ

**ä»£ç ä½ç½®**ï¼š`src/kimi_cli/cli/__init__.py` ç¬¬ 380 è¡Œ

```python
ui: UIMode = "shell"  # â† é»˜è®¤å€¼
```

**åŸå› **ï¼š
- Typer çš„ `@cli.callback(invoke_without_command=True)` è¡¨ç¤ºæ— å­å‘½ä»¤æ—¶è°ƒç”¨
- `ui` å˜é‡é»˜è®¤å€¼ä¸º `"shell"`
- åªæœ‰æ˜ç¡®æŒ‡å®š `--print`/`--acp`/`--wire` æ‰æ”¹å˜

### 3. UI æ¨¡å¼åˆ‡æ¢é€»è¾‘

```python
ui: UIMode = "shell"  # é»˜è®¤

if print_mode:      # kimi --print
    ui = "print"
elif acp_mode:      # kimi --acp
    ui = "acp"
elif wire_mode:     # kimi --wire
    ui = "wire"
```

### 4. Shell å¯åŠ¨å…³é”®æ­¥éª¤

1. **åˆ›å»º Session** - å­˜å‚¨å¯¹è¯å†å²
2. **åˆ›å»º KimiCLI** - åˆå§‹åŒ– Runtimeã€Agentã€Soul
3. **å¯åŠ¨ Shell UI** - æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ï¼Œè¿›å…¥ä¸»å¾ªç¯
4. **ç­‰å¾…è¾“å…¥** - ä½¿ç”¨ `prompt-toolkit` ç­‰å¾…ç”¨æˆ·è¾“å…¥

---

## ğŸ“š ç›¸å…³æºç æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶ | è¡Œæ•° | ä½œç”¨ |
|------|------|------|
| `pyproject.toml` | 66-68 | å®šä¹‰å‘½ä»¤è¡Œå…¥å£ |
| `src/kimi_cli/cli/__init__.py` | 24 | åˆ›å»º Typer åº”ç”¨ |
| `src/kimi_cli/cli/__init__.py` | 44-571 | ä¸»å›è°ƒå‡½æ•° kimi() |
| `src/kimi_cli/cli/__init__.py` | 380-386 | UI æ¨¡å¼é€‰æ‹© |
| `src/kimi_cli/cli/__init__.py` | 513-532 | è¿è¡Œå¯¹åº” UI |
| `src/kimi_cli/app.py` | 235-287 | run_shell() æ–¹æ³• |
| `src/kimi_cli/ui/shell/__init__.py` | - | Shell UI å®ç° |

---

## ğŸ¯ éªŒè¯æ–¹å¼

### 1. æ·»åŠ è°ƒè¯•è¾“å‡º

åœ¨ `src/kimi_cli/cli/__init__.py` çš„ `kimi()` å‡½æ•°å¼€å¤´æ·»åŠ ï¼š

```python
def kimi(...):
    print(f"[DEBUG] UI mode: {ui}")  # æ·»åŠ è¿™è¡Œ
    ...
```

### 2. æŸ¥çœ‹æ—¥å¿—

```bash
# Shell æ¨¡å¼çš„æ—¥å¿—åœ¨è¿™é‡Œ
cat ~/.kimi/logs/kimi.log
```

### 3. ä½¿ç”¨è°ƒè¯•å™¨

```python
# åœ¨ kimi() å‡½æ•°ä¸­è®¾ç½®æ–­ç‚¹
import pdb; pdb.set_trace()
```

---

**æ€»ç»“**ï¼š`uv run kimi` ä» `pyproject.toml` å¼€å§‹ â†’ `cli/__init__.py` â†’ `app.py` â†’ `ui/shell/__init__.py`ï¼Œé»˜è®¤å¯åŠ¨ Shell äº¤äº’æ¨¡å¼ã€‚
